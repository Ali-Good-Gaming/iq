<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IQ Тест PRO - Оцени свой интеллект</title>

    <!-- ====== ИКОНКИ ДЛЯ ВСЕХ УСТРОЙСТВ ====== -->
    <!-- Классический favicon для вкладки (16x16, 32x32) -->
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">

    <!-- Фавиконы PNG (остается как есть) -->
    <link rel="icon" type="image/png" sizes="32x32" href="./icons/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./icons/favicon-16.png">

    <!-- Иконка для iPhone/iPad -->
    <link rel="apple-touch-icon" sizes="180x180" href="./icons/apple-touch-icon.png">

    <!-- Android/Chrome PWA (если используешь) -->
    <link rel="manifest" href="./icons/site.webmanifest">

    <!-- Safari pinned tab (SVG, если есть) -->
    <link rel="mask-icon" href="./icons/safari-pinned-tab.svg" color="#000000">

    <!-- Цвет верхней строки на мобильных -->
    <meta name="theme-color" content="#ffffff">

    <!-- ====== ОСТАЛЬНЫЕ ПОДКЛЮЧЕНИЯ САЙТА ====== -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #3a6186, #89253e);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #fff;
            overflow-x: hidden;
            transition: background 0.5s ease;
        }

        /* Темы */
        body.theme-default {
            background: linear-gradient(135deg, #1a2a6c, #3a6186, #89253e);
        }

        body.theme-light {
            background: linear-gradient(135deg, #6a11cb, #2575fc, #43cea2);
            color: #333;
        }

        body.theme-blue {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(15, 23, 42, 0.85);
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            transition: background 0.5s ease, border-color 0.5s ease;
        }

        body.theme-light .container {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #333;
        }

        body.theme-blue .container {
            background: rgba(9, 10, 28, 0.9);
        }

        .header {
            background: linear-gradient(90deg, #0f172a, #1e3a8a);
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: background 0.5s ease;
        }

        body.theme-light .header {
            background: linear-gradient(90deg, #4b6cb7, #182848);
        }

        body.theme-blue .header {
            background: linear-gradient(90deg, #0c0e1f, #1a237e);
        }

        .header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
        }

        .header h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }

        .content {
            padding: 30px;
        }

        .screen {
            display: none;
            animation: fadeIn 0.6s ease-out;
        }

        .active {
            display: block;
        }

        .intro-screen, .result-screen {
            text-align: center;
        }

        .test-screen {
            padding: 20px;
            position: relative;
        }

        .intro-icon {
            font-size: 5rem;
            color: #60a5fa;
            margin: 30px 0;
            animation: pulse 2s infinite;
        }

        .description {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            text-align: left;
            border-left: 4px solid #60a5fa;
            transition: background 0.5s ease;
        }

        body.theme-light .description {
            background: rgba(225, 230, 240, 0.8);
            color: #333;
        }

        body.theme-blue .description {
            background: rgba(20, 25, 60, 0.8);
        }

        .description h3 {
            color: #60a5fa;
            margin-bottom: 15px;
            font-family: 'Montserrat', sans-serif;
        }

        .btn {
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 1.2rem;
            font-weight: 500;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 10px;
            font-family: 'Montserrat', sans-serif;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
            position: relative;
            overflow: hidden;
        }

        body.theme-light .btn {
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.6);
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn::after {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(30deg);
            transition: all 0.5s ease;
        }

        .btn:hover::after {
            transform: rotate(30deg) translate(20%, 20%);
        }

        .level-selector {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 30px 0;
        }

        .level-card {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        body.theme-light .level-card {
            background: rgba(225, 230, 240, 0.8);
            color: #333;
        }

        body.theme-blue .level-card {
            background: rgba(20, 25, 60, 0.7);
        }

        .level-card:hover {
            transform: translateY(-3px);
            border-color: #3b82f6;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        .level-card.selected {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
        }

        .level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .level-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #60a5fa;
        }

        .level-stats {
            font-size: 1.1rem;
            background: rgba(59, 130, 246, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
        }

        .level-description {
            font-size: 1rem;
            opacity: 0.9;
            padding-left: 10px;
            border-left: 3px solid #3b82f6;
            margin-top: 10px;
        }

        .question-container {
            margin-bottom: 30px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: background 0.5s ease;
        }

        body.theme-light .question-container {
            background: rgba(225, 230, 240, 0.8);
            color: #333;
        }

        body.theme-blue .question-container {
            background: rgba(20, 25, 60, 0.7);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            font-size: 1.1rem;
            background: rgba(59, 130, 246, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 500;
        }

        .timer {
            font-size: 1.1rem;
            background: rgba(220, 38, 38, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 500;
        }

        .question-text {
            font-size: 1.4rem;
            margin-bottom: 25px;
            font-weight: 500;
            line-height: 1.5;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .options-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        @media (max-width: 600px) {
            .options-container {
                grid-template-columns: 1fr;
            }
        }

        .option {
            background: rgba(51, 65, 85, 0.7);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        body.theme-light .option {
            background: rgba(200, 210, 230, 0.8);
            color: #333;
        }

        body.theme-blue .option {
            background: rgba(30, 35, 70, 0.8);
        }

        .option:hover {
            background: rgba(71, 85, 105, 0.9);
            transform: translateY(-3px);
            border-color: rgba(59, 130, 246, 0.5);
        }

        .option.selected {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
            transform: scale(1.03);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
        }

        .option.correct {
            background: rgba(34, 197, 94, 0.3);
            border-color: #22c55e;
        }

        .option.incorrect {
            background: rgba(220, 38, 38, 0.3);
            border-color: #ef4444;
        }

        .explanation {
            margin-top: 20px;
            padding: 15px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 10px;
            border-left: 3px solid #3b82f6;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        body.theme-light .explanation {
            background: rgba(200, 220, 255, 0.3);
            color: #333;
        }

        .progress-container {
            margin: 30px 0;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 10px;
            height: 12px;
            overflow: hidden;
        }

        body.theme-light .progress-container {
            background: rgba(200, 210, 230, 0.5);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .result-screen {
            padding: 40px 20px;
        }

        .result-value {
            font-size: 5rem;
            font-weight: 700;
            margin: 30px 0;
            color: #3b82f6;
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.7);
            animation: pulse 2s infinite;
        }

        .result-text {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #60a5fa;
        }

        .result-description {
            max-width: 600px;
            margin: 0 auto 30px;
            line-height: 1.7;
            font-size: 1.1rem;
            background: rgba(30, 41, 59, 0.6);
            padding: 25px;
            border-radius: 15px;
            text-align: left;
            transition: background 0.5s ease;
        }

        body.theme-light .result-description {
            background: rgba(225, 230, 240, 0.8);
            color: #333;
        }

        body.theme-blue .result-description {
            background: rgba(20, 25, 60, 0.7);
        }

        .iq-scale {
            width: 90%;
            max-width: 600px;
            height: 40px;
            background: linear-gradient(90deg, #ef4444, #f59e0b, #22c55e, #3b82f6, #8b5cf6);
            margin: 30px auto;
            border-radius: 20px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .iq-marker {
            position: absolute;
            top: -10px;
            width: 4px;
            height: 60px;
            background: white;
            transform: translateX(-50%);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            transition: left 1.5s ease-out;
        }

        .iq-labels {
            display: flex;
            justify-content: space-between;
            width: 90%;
            max-width: 600px;
            margin: 10px auto 30px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .stat-box {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 15px;
            padding: 20px;
            min-width: 150px;
            text-align: center;
            border-top: 3px solid #3b82f6;
            transition: background 0.5s ease;
        }

        body.theme-light .stat-box {
            background: rgba(225, 230, 240, 0.8);
            color: #333;
        }

        body.theme-blue .stat-box {
            background: rgba(20, 25, 60, 0.7);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 10px 0;
            color: #60a5fa;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.8;
        }

        .animation-container {
            height: 150px;
            position: relative;
            margin: 30px 0;
        }

        .brain-animation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 6rem;
            color: #3b82f6;
        }

        .hidden {
            display: none;
        }

        .settings-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(15, 23, 42, 0.9);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        body.theme-light .settings-panel {
            background: rgba(225, 230, 240, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.2);
        }

        .settings-panel:hover {
            transform: rotate(30deg);
            background: rgba(30, 41, 59, 0.9);
        }

        .settings-panel i {
            font-size: 1.5rem;
            color: #60a5fa;
        }

        .menu-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(15, 23, 42, 0.9);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        body.theme-light .menu-panel {
            background: rgba(225, 230, 240, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.2);
        }

        .menu-panel:hover {
            transform: rotate(-30deg);
            background: rgba(30, 41, 59, 0.9);
        }

        .menu-panel i {
            font-size: 1.5rem;
            color: #60a5fa;
        }

        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .settings-modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .settings-content {
            background: rgba(15, 23, 42, 0.95);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        body.theme-light .settings-content {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
        }

        body.theme-blue .settings-content {
            background: rgba(9, 10, 28, 0.95);
        }

        .settings-modal.active .settings-content {
            transform: translateY(0);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .settings-header h2 {
            font-size: 1.8rem;
            color: #60a5fa;
        }

        .close-settings {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        body.theme-light .close-settings {
            color: #333;
        }

        .setting-item {
            margin-bottom: 25px;
        }

        .setting-item label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        body.theme-light .setting-item label {
            color: #333;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .volume-slider {
            flex-grow: 1;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: rgba(100, 100, 100, 0.5);
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }

        .volume-icon {
            font-size: 1.5rem;
            width: 30px;
            text-align: center;
            color: #60a5fa;
        }

        .theme-selector {
            display: flex;
            gap: 15px;
        }

        .theme-option {
            flex: 1;
            padding: 15px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            background: rgba(30, 41, 59, 0.7);
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }

        body.theme-light .theme-option {
            background: rgba(225, 230, 240, 0.8);
        }

        .theme-option.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.2);
        }

        .results-tabs {
            display: flex;
            justify-content: center;
            margin: 20px 0 30px;
            gap: 10px;
        }

        .result-tab {
            padding: 10px 20px;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        body.theme-light .result-tab {
            background: rgba(225, 230, 240, 0.8);
            color: #333;
        }

        body.theme-blue .result-tab {
            background: rgba(20, 25, 60, 0.7);
        }

        .result-tab.active {
            background: rgba(59, 130, 246, 0.3);
        }

        .result-content {
            display: none;
        }

        .result-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .calculation-info {
            background: rgba(30, 41, 59, 0.6);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            line-height: 1.7;
            transition: background 0.5s ease;
        }

        body.theme-light .calculation-info {
            background: rgba(225, 230, 240, 0.8);
            color: #333;
        }

        body.theme-blue .calculation-info {
            background: rgba(20, 25, 60, 0.7);
        }

        .formula {
            font-family: monospace;
            font-size: 1.2rem;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            border-left: 3px solid #3b82f6;
        }

        body.theme-light .formula {
            background: rgba(200, 210, 230, 0.8);
        }

        .parameter {
            display: flex;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.theme-light .parameter {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .param-name {
            width: 200px;
            font-weight: 500;
        }

        footer {
            text-align: center;
            padding: 20px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            background: rgba(15, 23, 42, 0.7);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            transition: background 0.5s ease;
        }

        body.theme-light footer {
            background: rgba(225, 230, 240, 0.8);
            color: #333;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.theme-blue footer {
            background: rgba(9, 10, 28, 0.7);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes confetti {
            0% { transform: translateY(0) rotate(0); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ff0;
            opacity: 0;
            animation: confetti 3s ease-in-out forwards;
            z-index: 1000;
        }
    </style>
</head>
<body class="theme-default">
    <div class="container">
        <!-- Панель меню -->
        <div class="menu-panel hidden" id="menuPanel">
            <i class="fas fa-home"></i>
        </div>
        
        <!-- Панель настроек -->
        <div class="settings-panel">
            <i class="fas fa-cog"></i>
        </div>
        
        <div class="header">
            <h1><i class="fas fa-brain"></i> IQ Тест PRO</h1>
            <p>Выберите уровень сложности и проверьте свои интеллектуальные способности</p>
        </div>
        
        <div class="content">
            <!-- Экран выбора уровня -->
            <div id="levelScreen" class="screen active">
                <div class="intro-screen">
                    <h2>Выберите уровень теста</h2>
                    <p>Тесты различаются количеством вопросов и временем на прохождение</p>
                    
                    <div class="level-selector">
                        <div class="level-card selected" data-level="fast">
                            <div class="level-header">
                                <div class="level-title">Быстрый тест</div>
                                <div class="level-stats">15 вопросов</div>
                            </div>
                            <div class="level-description">
                                ~7 минут · Идеально для быстрой проверки
                            </div>
                        </div>
                        
                        <div class="level-card" data-level="medium">
                            <div class="level-header">
                                <div class="level-title">Средний тест</div>
                                <div class="level-stats">30 вопросов</div>
                            </div>
                            <div class="level-description">
                                ~15 минут · Оптимальный баланс
                            </div>
                        </div>
                        
                        <div class="level-card" data-level="long">
                            <div class="level-header">
                                <div class="level-title">Долгий тест</div>
                                <div class="level-stats">50 вопросов</div>
                            </div>
                            <div class="level-description">
                                ~25 минут · Самый точный результат
                            </div>
                        </div>
                    </div>
                    
                    <button id="startBtn" class="btn">
                        <i class="fas fa-play"></i> Начать тест
                    </button>
                </div>
            </div>
            
            <!-- Экран теста -->
            <div id="testScreen" class="screen">
                <div class="test-screen">
                    <div class="question-header">
                        <div class="question-number">Вопрос <span id="currentQuestion">1</span> из <span id="totalQuestions">15</span></div>
                        <div class="timer"><i class="fas fa-clock"></i> <span id="timeLeft">30</span> сек</div>
                    </div>
                    
                    <div class="question-container">
                        <div class="question-text" id="questionText">
                            Загрузка вопроса...
                        </div>
                        
                        <div class="options-container" id="optionsContainer">
                            <!-- Варианты ответов будут добавлены через JS -->
                        </div>
                        
                        <div class="explanation" id="explanation">
                            <!-- Пояснение будет добавлено через JS -->
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    
                    <button id="nextBtn" class="btn hidden">
                        <i class="fas fa-arrow-right"></i> Следующий вопрос
                    </button>
                </div>
            </div>
            
            <!-- Экран результатов -->
            <div id="resultScreen" class="screen">
                <div class="result-screen">
                    <h2>Ваш результат IQ теста</h2>
                    
                    <div class="animation-container">
                        <div class="brain-animation">
                            <i class="fas fa-brain"></i>
                        </div>
                    </div>
                    
                    <div class="result-value" id="iqScore">0</div>
                    <div class="result-text" id="resultText">Анализируем результат...</div>
                    
                    <div class="iq-scale">
                        <div class="iq-marker" id="iqMarker"></div>
                    </div>
                    
                    <div class="iq-labels">
                        <div>70</div>
                        <div>85</div>
                        <div>100</div>
                        <div>115</div>
                        <div>130</div>
                    </div>
                    
                    <div class="results-tabs">
                        <div class="result-tab active" data-tab="result">Результат</div>
                        <div class="result-tab" data-tab="calculation">Как мы считаем</div>
                        <div class="result-tab" data-tab="stats">Статистика</div>
                    </div>
                    
                    <div class="result-content active" id="resultContent">
                        <div class="result-description" id="resultDescription">
                            Ваш результат обрабатывается и сравнивается с нормами для вашей возрастной группы...
                        </div>
                    </div>
                    
                    <div class="result-content" id="calculationContent">
                        <div class="calculation-info">
                            <h3>Формула расчета IQ</h3>
                            <p>Мы используем стандартизированную формулу для расчета IQ:</p>
                            
                            <div class="formula">
                                IQ = minIQ + (правильные ответы / всего вопросов) × (maxIQ - minIQ)
                            </div>
                            
                            <div class="parameters" id="iqParams">
                                <!-- Параметры будут заполнены через JS -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-content" id="statsContent">
                        <div class="stats">
                            <div class="stat-box">
                                <div class="stat-label">Правильные ответы</div>
                                <div class="stat-value" id="correctAnswers">0</div>
                                <div class="stat-label">из <span id="totalQuestionsResult">15</span></div>
                            </div>
                            
                            <div class="stat-box">
                                <div class="stat-label">Точность</div>
                                <div class="stat-value" id="accuracy">0%</div>
                                <div class="stat-label">ответов</div>
                            </div>
                            
                            <div class="stat-box">
                                <div class="stat-label">Уровень теста</div>
                                <div class="stat-value" id="testLevel">Быстрый</div>
                                <div class="stat-label"><span id="questionsCount">15</span> вопросов</div>
                            </div>
                        </div>
                    </div>
                    
                    <button id="restartBtn" class="btn">
                        <i class="fas fa-redo"></i> Пройти тест снова
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Модальное окно настроек -->
        <div class="settings-modal">
            <div class="settings-content">
                <div class="settings-header">
                    <h2><i class="fas fa-cog"></i> Настройки</h2>
                    <button class="close-settings">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="setting-item">
                    <label><i class="fas fa-volume-up"></i> Громкость звука</label>
                    <div class="volume-control">
                        <div class="volume-icon">
                            <i class="fas fa-volume-off"></i>
                        </div>
                        <input type="range" min="0" max="100" value="80" class="volume-slider" id="volumeSlider">
                        <div class="volume-icon">
                            <i class="fas fa-volume-up"></i>
                        </div>
                    </div>
                </div>
                
                <div class="setting-item">
                    <label><i class="fas fa-palette"></i> Цветовая тема</label>
                    <div class="theme-selector">
                        <div class="theme-option selected" data-theme="default">
                            <i class="fas fa-moon"></i><br>Тёмная
                        </div>
                        <div class="theme-option" data-theme="light">
                            <i class="fas fa-sun"></i><br>Светлая
                        </div>
                        <div class="theme-option" data-theme="blue">
                            <i class="fas fa-water"></i><br>Синяя
                        </div>
                    </div>
                </div>
                
                <div class="setting-item">
                    <label><i class="fas fa-clock"></i> Время на вопрос</label>
                    <div class="volume-control">
                        <div class="volume-icon">
                            <i class="fas fa-stopwatch"></i>
                        </div>
                        <input type="range" min="10" max="60" value="30" class="volume-slider" id="timeSlider">
                        <div class="volume-icon">
                            <i class="fas fa-hourglass-end"></i>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 10px;">
                        <span id="timeValue">30 секунд</span>
                    </div>
                </div>
                
                <button id="saveSettingsBtn" class="btn" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-save"></i> Сохранить настройки
                </button>
            </div>
        </div>
        
        <footer>
            <p>Данный тест предоставляет оценку интеллекта в развлекательных целях. Для профессиональной оценки IQ обратитесь к сертифицированному психологу.</p>
            <p>© 2025 IQ Тест PRO | Основано на стандартных методиках оценки интеллекта</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Элементы интерфейса
            const levelScreen = document.getElementById('levelScreen');
            const testScreen = document.getElementById('testScreen');
            const resultScreen = document.getElementById('resultScreen');
            const menuPanel = document.getElementById('menuPanel');
            const settingsPanel = document.querySelector('.settings-panel');
            const settingsModal = document.querySelector('.settings-modal');
            const closeSettings = document.querySelector('.close-settings');
            const volumeSlider = document.getElementById('volumeSlider');
            const timeSlider = document.getElementById('timeSlider');
            const timeValue = document.getElementById('timeValue');
            const themeOptions = document.querySelectorAll('.theme-option');
            const levelCards = document.querySelectorAll('.level-card');
            const startBtn = document.getElementById('startBtn');
            const nextBtn = document.getElementById('nextBtn');
            const restartBtn = document.getElementById('restartBtn');
            const saveSettingsBtn = document.getElementById('saveSettingsBtn');
            const questionText = document.getElementById('questionText');
            const optionsContainer = document.getElementById('optionsContainer');
            const explanation = document.getElementById('explanation');
            const currentQuestion = document.getElementById('currentQuestion');
            const totalQuestions = document.getElementById('totalQuestions');
            const timeLeft = document.getElementById('timeLeft');
            const progressBar = document.getElementById('progressBar');
            const iqScore = document.getElementById('iqScore');
            const resultText = document.getElementById('resultText');
            const resultDescription = document.getElementById('resultDescription');
            const correctAnswers = document.getElementById('correctAnswers');
            const accuracy = document.getElementById('accuracy');
            const testLevel = document.getElementById('testLevel');
            const questionsCount = document.getElementById('questionsCount');
            const totalQuestionsResult = document.getElementById('totalQuestionsResult');
            const iqMarker = document.getElementById('iqMarker');
            const iqParams = document.getElementById('iqParams');
            const resultTabs = document.querySelectorAll('.result-tab');
            const resultContents = document.querySelectorAll('.result-content');
            
            // Переменные теста
            let selectedLevel = 'fast';
            let timePerQuestion = 30;
            let volume = 80;
            let questions = [];
            let currentQuestionIndex = 0;
            let score = 0;
            let timer;
            let timeRemaining = timePerQuestion;
            let answerTimes = [];
            let selectedOption = null;
            let totalQuestionsCount = 15;
            let audioContext;
            
            // Полный набор из 50 вопросов
            const allQuestions = [
                { 
                    question: "Какое число должно быть следующим в последовательности: 2, 4, 8, 16, ...?", 
                    options: ["24", "32", "64", "20"], 
                    answer: 1,
                    explanation: "Это геометрическая прогрессия, где каждое следующее число умножается на 2. 16 * 2 = 32.",
                    type: "numerical" 
                },
                { 
                    question: "Если все ВИШНИ - это ФРУКТЫ, а некоторые ФРУКТЫ - КРАСНЫЕ, то некоторые ВИШНИ обязательно КРАСНЫЕ?", 
                    options: ["Да", "Нет", "Недостаточно информации", "Возможно"], 
                    answer: 2,
                    explanation: "Хотя все вишни - фрукты, а некоторые фрукты красные, это не означает, что именно вишни относятся к красным фруктам. Могут быть и другие красные фрукты.",
                    type: "verbal" 
                },
                { 
                    question: "Выберите фигуру, которая отличается от остальных:", 
                    options: ["▲", "●", "■", "◆"], 
                    answer: 1,
                    explanation: "Круг (●) - единственная фигура без углов, все остальные - многоугольники.",
                    type: "spatial" 
                },
                { 
                    question: "Продолжите последовательность: A, D, G, J, ...", 
                    options: ["K", "L", "M", "N"], 
                    answer: 2,
                    explanation: "Буквы алфавита через 2: A (1), D (4), G (7), J (10), следующая M (13).",
                    type: "sequence" 
                },
                { 
                    question: "Решите: (5 * 3) + (12 / 4) - 2", 
                    options: ["14", "15", "16", "17"], 
                    answer: 2,
                    explanation: "Сначала умножение и деление: 5*3=15, 12/4=3. Затем сложение и вычитание: 15+3=18, 18-2=16.",
                    type: "numerical" 
                },
                { 
                    question: "Какое слово лишнее?", 
                    options: ["Москва", "Париж", "Лондон", "Европа"], 
                    answer: 3,
                    explanation: "Москва, Париж и Лондон - столицы, а Европа - это континент.",
                    type: "verbal" 
                },
                { 
                    question: "Если 3 рабочих могут построить дом за 12 дней, сколько дней понадобится 4 рабочим?", 
                    options: ["8", "9", "10", "16"], 
                    answer: 1,
                    explanation: "3 рабочих * 12 дней = 36 человеко-дней. 36 / 4 рабочих = 9 дней.",
                    type: "logical" 
                },
                { 
                    question: "Продолжите последовательность: 1, 1, 2, 3, 5, 8, ...", 
                    options: ["10", "11", "12", "13"], 
                    answer: 3,
                    explanation: "Это последовательность Фибоначчи, где каждое число равно сумме двух предыдущих. 5 + 8 = 13.",
                    type: "sequence" 
                },
                { 
                    question: "Какая фигура следующая в последовательности? ◻ ◼ ◻ ◼ ◻ ...", 
                    options: ["◼", "◻", "◯", "▲"], 
                    answer: 0,
                    explanation: "Чередование белого и черного квадратов. После белого квадрата должен быть черный.",
                    type: "spatial" 
                },
                { 
                    question: "Столица относится к стране как губернатор к...?", 
                    options: ["Город", "Штат", "Президент", "Нация"], 
                    answer: 1,
                    explanation: "Столица - главный город страны, губернатор - глава штата.",
                    type: "analogy" 
                },
                { 
                    question: "Решите: 25% от 200", 
                    options: ["25", "40", "50", "75"], 
                    answer: 2,
                    explanation: "25% - это четверть от числа. 200 / 4 = 50.",
                    type: "numerical" 
                },
                { 
                    question: "Если все ZUPAS - это BORGS, а некоторые BORGS - CRONKS, то некоторые ZUPAS обязательно CRONKS?", 
                    options: ["Да", "Нет", "Недостаточно информации", "Возможно"], 
                    answer: 2,
                    explanation: "Не обязательно, что именно ZUPAS являются CRONKS. Могут быть другие BORGS, которые являются CRONKS.",
                    type: "logical" 
                },
                { 
                    question: "Какое число пропущено: 8, 16, 24, 32, ?, 48", 
                    options: ["36", "38", "40", "42"], 
                    answer: 2,
                    explanation: "Последовательность увеличивается на 8: 8, 16, 24, 32, 40, 48.",
                    type: "sequence" 
                },
                { 
                    question: "Выберите слово, противоположное по смыслу слову 'ЩЕДРЫЙ'", 
                    options: ["Добрый", "Жадный", "Богатый", "Великодушный"], 
                    answer: 1,
                    explanation: "Противоположность щедрости - жадность.",
                    type: "verbal" 
                },
                { 
                    question: "Какая фигура является зеркальным отражением данной: ◢", 
                    options: ["◣", "◤", "◥", "◩"], 
                    answer: 0,
                    explanation: "Зеркальное отражение правого треугольника - левый треугольник.",
                    type: "spatial" 
                },
                { 
                    question: "Продолжите последовательность: 3, 6, 9, 12, ...", 
                    options: ["14", "15", "16", "18"], 
                    answer: 1,
                    explanation: "Арифметическая прогрессия с шагом 3: 12 + 3 = 15.",
                    type: "numerical" 
                },
                { 
                    question: "Сколько углов останется, если у квадрата отрезать один угол?", 
                    options: ["3", "4", "5", "6"], 
                    answer: 2,
                    explanation: "При отрезании угла квадрата вместо одного угла получается два новых. Итого: 4 - 1 + 2 = 5 углов.",
                    type: "spatial" 
                },
                { 
                    question: "Что легче: 1 кг железа или 1 кг пуха?", 
                    options: ["Железо", "Пух", "Одинаково", "Зависит от условий"], 
                    answer: 2,
                    explanation: "1 кг любого вещества весит одинаково - 1 кг.",
                    type: "logical" 
                },
                { 
                    question: "Продолжите аналогию: Стол - дерево, Стакан - ...", 
                    options: ["Стекло", "Вода", "Кухня", "Пить"], 
                    answer: 0,
                    explanation: "Стол делают из дерева, стакан - из стекла.",
                    type: "verbal" 
                },
                { 
                    question: "Какая фигура следующая? ▲, ▼, ▶, ◀, ...", 
                    options: ["●", "▲", "▼", "◆"], 
                    answer: 1,
                    explanation: "Последовательность: треугольник вверх, вниз, вправо, влево, затем снова вверх.",
                    type: "spatial" 
                },
                { 
                    question: "Решите: 2² + 3² = ?", 
                    options: ["5", "7", "10", "13"], 
                    answer: 3,
                    explanation: "2 в квадрате = 4, 3 в квадрате = 9. 4 + 9 = 13.",
                    type: "numerical" 
                },
                { 
                    question: "Какое слово лишнее?", 
                    options: ["Собака", "Кошка", "Воробей", "Корова"], 
                    answer: 2,
                    explanation: "Воробей - птица, остальные - млекопитающие.",
                    type: "verbal" 
                },
                { 
                    question: "Если A = 1, B = 2, то C + D = ?", 
                    options: ["5", "6", "7", "8"], 
                    answer: 2,
                    explanation: "C - 3 буква алфавита, D - 4. 3 + 4 = 7.",
                    type: "logical" 
                },
                { 
                    question: "Какое число пропущено: 5, 10, ..., 20, 25", 
                    options: ["12", "15", "18", "22"], 
                    answer: 1,
                    explanation: "Арифметическая прогрессия с шагом 5: 5, 10, 15, 20, 25.",
                    type: "sequence" 
                },
                { 
                    question: "Продолжите последовательность: Z, X, V, T, ...", 
                    options: ["R", "S", "Q", "P"], 
                    answer: 0,
                    explanation: "Алфавит в обратном порядке через одну букву: Z (26), X (24), V (22), T (20), R (18).",
                    type: "sequence" 
                },
                { 
                    question: "Что не принадлежит к группе?", 
                    options: ["Квадрат", "Круг", "Треугольник", "Куб"], 
                    answer: 3,
                    explanation: "Куб - объемная фигура, остальные - плоские.",
                    type: "spatial" 
                },
                { 
                    question: "Решите: 7 × 8 - 6 × 5", 
                    options: ["16", "26", "36", "46"], 
                    answer: 1,
                    explanation: "7*8=56, 6*5=30. 56-30=26.",
                    type: "numerical" 
                },
                { 
                    question: "Продолжите аналогию: Холодный - горячий, как день - ...", 
                    options: ["Ночь", "Свет", "Тепло", "Яркий"], 
                    answer: 0,
                    explanation: "Холодный и горячий - антонимы, день и ночь - тоже антонимы.",
                    type: "verbal" 
                },
                { 
                    question: "Какое число следующее: 1, 4, 9, 16, ...", 
                    options: ["25", "30", "36", "49"], 
                    answer: 0,
                    explanation: "Квадраты чисел: 1²=1, 2²=4, 3²=9, 4²=16, 5²=25.",
                    type: "sequence" 
                },
                { 
                    question: "Если все книги имеют страницы, а некоторые страницы пустые, то все книги имеют пустые страницы?", 
                    options: ["Да", "Нет", "Не всегда", "Иногда"], 
                    answer: 1,
                    explanation: "Не все книги обязаны иметь пустые страницы. Некоторые могут не иметь их совсем.",
                    type: "logical" 
                },
                { 
                    question: "Какая фигура лишняя?", 
                    options: ["▲", "●", "★", "◆"], 
                    answer: 2,
                    explanation: "Звезда имеет больше лучей, чем остальные фигуры.",
                    type: "spatial" 
                },
                { 
                    question: "Решите: 1/2 + 1/4 = ?", 
                    options: ["1/6", "1/8", "3/4", "2/6"], 
                    answer: 2,
                    explanation: "1/2 = 2/4, 2/4 + 1/4 = 3/4.",
                    type: "numerical" 
                },
                { 
                    question: "Синоним к слову 'БЫСТРЫЙ'", 
                    options: ["Скорый", "Медленный", "Тихий", "Громкий"], 
                    answer: 0,
                    explanation: "Скорый - прямой синоним к слову быстрый.",
                    type: "verbal" 
                },
                { 
                    question: "Продолжите: 2, 3, 5, 7, 11, ...", 
                    options: ["12", "13", "14", "15"], 
                    answer: 1,
                    explanation: "Последовательность простых чисел: 2, 3, 5, 7, 11, 13.",
                    type: "sequence" 
                },
                { 
                    question: "Если повернуть ▲ на 180°, что получится?", 
                    options: ["▼", "►", "◄", "▲"], 
                    answer: 0,
                    explanation: "Треугольник при повороте на 180° смотрит вниз.",
                    type: "spatial" 
                },
                { 
                    question: "Решите: 100 - 45 / 5", 
                    options: ["11", "55", "91", "95"], 
                    answer: 2,
                    explanation: "Сначала деление: 45/5=9, затем 100-9=91.",
                    type: "numerical" 
                },
                { 
                    question: "Антоним к слову 'ВЫСОКИЙ'", 
                    options: ["Длинный", "Низкий", "Широкий", "Узкий"], 
                    answer: 1,
                    explanation: "Прямой антоним к слову высокий - низкий.",
                    type: "verbal" 
                },
                { 
                    question: "Какое число следующее: 10, 20, 40, 80, ...", 
                    options: ["100", "120", "140", "160"], 
                    answer: 3,
                    explanation: "Геометрическая прогрессия с множителем 2: 80*2=160.",
                    type: "sequence" 
                },
                { 
                    question: "Сколько сторон у пентагона?", 
                    options: ["4", "5", "6", "8"], 
                    answer: 1,
                    explanation: "Пентагон - пятиугольник, имеет 5 сторон.",
                    type: "numerical" 
                },
                { 
                    question: "Продолжите: Апельсин - фрукт, Картофель - ...", 
                    options: ["Овощ", "Фрукт", "Ягода", "Корнеплод"], 
                    answer: 0,
                    explanation: "Апельсин - фрукт, картофель - овощ.",
                    type: "verbal" 
                },
                { 
                    question: "Какое число пропущено: 3, 8, 15, 24, ?, 48", 
                    options: ["32", "35", "36", "40"], 
                    answer: 1,
                    explanation: "Разность увеличивается на 2: +5, +7, +9, +11, +13. 24+11=35.",
                    type: "sequence" 
                },
                { 
                    question: "Если ▲ + ■ = 10, а ▲ - ■ = 2, то ▲ = ?", 
                    options: ["4", "5", "6", "7"], 
                    answer: 2,
                    explanation: "Решим систему: ▲ = (10 + 2)/2 = 6, ■ = 10 - 6 = 4.",
                    type: "logical" 
                },
                { 
                    question: "Какая фигура не имеет углов?", 
                    options: ["Квадрат", "Треугольник", "Круг", "Прямоугольник"], 
                    answer: 2,
                    explanation: "Круг - единственная фигура без углов.",
                    type: "spatial" 
                },
                { 
                    question: "Решите: 0.5 × 0.2 = ?", 
                    options: ["0.1", "0.01", "1.0", "10"], 
                    answer: 0,
                    explanation: "0.5 * 0.2 = 0.10 или 0.1.",
                    type: "numerical" 
                },
                { 
                    question: "Продолжите: Лето - жаркое, Зима - ...", 
                    options: ["Теплая", "Холодная", "Влажная", "Сухая"], 
                    answer: 1,
                    explanation: "Основная характеристика зимы - холодная.",
                    type: "verbal" 
                },
                { 
                    question: "Какое число следующее: 1, 3, 6, 10, 15, ...", 
                    options: ["20", "21", "22", "25"], 
                    answer: 1,
                    explanation: "Треугольные числа: 1, 1+2=3, 3+3=6, 6+4=10, 10+5=15, 15+6=21.",
                    type: "sequence" 
                },
                { 
                    question: "Сколько градусов в прямом угле?", 
                    options: ["90", "100", "180", "360"], 
                    answer: 0,
                    explanation: "Прямой угол всегда равен 90 градусам.",
                    type: "numerical" 
                },
                { 
                    question: "Что тяжелее: 1 кг ваты или 1 кг железа?", 
                    options: ["Вата", "Железо", "Одинаково", "Зависит от объема"], 
                    answer: 2,
                    explanation: "1 кг любого вещества весит одинаково - 1 кг.",
                    type: "logical" 
                },
                { 
                    question: "Продолжите: Птица - летать, Рыба - ...", 
                    options: ["Плавать", "Бегать", "Прыгать", "Ползать"], 
                    answer: 0,
                    explanation: "Птица летает, рыба плавает.",
                    type: "verbal" 
                },
                { 
                    question: "Какое число следующее: 1, 8, 27, 64, ...", 
                    options: ["81", "100", "125", "144"], 
                    answer: 2,
                    explanation: "Кубы чисел: 1³=1, 2³=8, 3³=27, 4³=64, 5³=125.",
                    type: "sequence" 
                },
                { 
                    question: "Решите: 15% от 300", 
                    options: ["30", "35", "40", "45"], 
                    answer: 3,
                    explanation: "15% = 0.15, 0.15 * 300 = 45.",
                    type: "numerical" 
                },
                { 
                    question: "Если сегодня среда, какой день будет через 5 дней?", 
                    options: ["Понедельник", "Вторник", "Суббота", "Воскресенье"], 
                    answer: 0,
                    explanation: "Через 7 дней была бы снова среда, значит через 5 дней: четверг, пятница, суббота, воскресенье, понедельник.",
                    type: "logical" 
                },
                { 
                    question: "Какое слово лишнее?", 
                    options: ["Яблоко", "Груша", "Банан", "Морковь"], 
                    answer: 3,
                    explanation: "Морковь - овощ, остальные - фрукты.",
                    type: "verbal" 
                },
                { 
                    question: "Сколько месяцев в году имеют 30 дней?", 
                    options: ["4", "5", "6", "7"], 
                    answer: 0,
                    explanation: "Апрель, июнь, сентябрь, ноябрь - 4 месяца.",
                    type: "numerical" 
                }
            ];

            // Инициализация аудио
            function initAudio() {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log("Web Audio API не поддерживается в этом браузере");
                }
            }
            
            // Воспроизведение звука
            function playSound(type) {
                if (!audioContext || volume == 0) return;
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Настройки звука в зависимости от типа
                switch(type) {
                    case 'start':
                        oscillator.frequency.value = 523.25; // До
                        gainNode.gain.value = volume / 200;
                        break;
                    case 'correct':
                        oscillator.frequency.value = 659.25; // Ми
                        gainNode.gain.value = volume / 150;
                        break;
                    case 'incorrect':
                        oscillator.frequency.value = 392.00; // Соль
                        gainNode.gain.value = volume / 200;
                        break;
                    case 'next':
                        oscillator.frequency.value = 783.99; // Соль следующей октавы
                        gainNode.gain.value = volume / 180;
                        break;
                    case 'timeup':
                        oscillator.frequency.value = 311.13; // Ре#
                        gainNode.gain.value = volume / 200;
                        break;
                    case 'result':
                        oscillator.frequency.value = 1046.50; // До следующей октавы
                        gainNode.gain.value = volume / 100;
                        break;
                    case 'select':
                        oscillator.frequency.value = 440.00; // Ля
                        gainNode.gain.value = volume / 200;
                        break;
                    default:
                        oscillator.frequency.value = 440.00;
                        gainNode.gain.value = volume / 200;
                }
                
                oscillator.start();
                
                setTimeout(() => {
                    oscillator.stop();
                }, 300);
            }
            
            // Загрузка настроек
            function loadSettings() {
                const savedSettings = localStorage.getItem('iqTestSettings');
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    volume = settings.volume;
                    timePerQuestion = settings.timePerQuestion;
                    volumeSlider.value = volume;
                    timeSlider.value = timePerQuestion;
                    timeValue.textContent = `${timePerQuestion} секунд`;
                    
                    // Применение темы
                    themeOptions.forEach(option => {
                        option.classList.remove('selected');
                        if (option.dataset.theme === settings.theme) {
                            option.classList.add('selected');
                            applyTheme(settings.theme);
                        }
                    });
                }
            }
            
            // Сохранение настроек
            function saveSettings() {
                let selectedTheme = 'default';
                themeOptions.forEach(option => {
                    if (option.classList.contains('selected')) {
                        selectedTheme = option.dataset.theme;
                    }
                });
                
                const settings = {
                    volume: volume,
                    timePerQuestion: timePerQuestion,
                    theme: selectedTheme
                };
                
                localStorage.setItem('iqTestSettings', JSON.stringify(settings));
                settingsModal.classList.remove('active');
                playSound('select');
            }
            
            // Применение темы
            function applyTheme(theme) {
                document.body.className = `theme-${theme}`;
            }
            
            // Функция для перемешивания массива (алгоритм Фишера-Йетса)
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // Начало теста
            startBtn.addEventListener('click', () => {
                playSound('start');
                
                // Определяем количество вопросов
                switch(selectedLevel) {
                    case 'fast': totalQuestionsCount = 15; break;
                    case 'medium': totalQuestionsCount = 30; break;
                    case 'long': totalQuestionsCount = 50; break;
                }
                
                // Создаем копию всех вопросов и перемешиваем
                const shuffledQuestions = shuffleArray([...allQuestions]);
                // Берем нужное количество вопросов
                questions = shuffledQuestions.slice(0, totalQuestionsCount);
                
                totalQuestions.textContent = totalQuestionsCount;
                
                levelScreen.classList.remove('active');
                testScreen.classList.add('active');
                menuPanel.classList.remove('hidden');
                
                currentQuestionIndex = 0;
                score = 0;
                answerTimes = [];
                
                loadQuestion();
                startTimer();
            });
            
            // Загрузка вопроса
            function loadQuestion() {
                const question = questions[currentQuestionIndex];
                questionText.textContent = question.question;
                optionsContainer.innerHTML = '';
                explanation.style.display = 'none';
                explanation.innerHTML = '';
                
                // Обновление номера вопроса
                currentQuestion.textContent = currentQuestionIndex + 1;
                
                // Обновление прогресс бара
                const progress = ((currentQuestionIndex) / questions.length) * 100;
                progressBar.style.width = `${progress}%`;
                
                // Создание вариантов ответов
                question.options.forEach((option, index) => {
                    const optionElement = document.createElement('div');
                    optionElement.classList.add('option');
                    optionElement.textContent = option;
                    optionElement.dataset.index = index;
                    
                    optionElement.addEventListener('click', () => {
                        if (selectedOption !== null) return;
                        
                        playSound('select');
                        selectedOption = index;
                        clearInterval(timer);
                        
                        // Запись времени ответа
                        const answerTime = timePerQuestion - timeRemaining;
                        answerTimes.push(answerTime);
                        
                        // Проверка ответа
                        if (index === question.answer) {
                            optionElement.classList.add('correct');
                            playSound('correct');
                            score++;
                        } else {
                            optionElement.classList.add('incorrect');
                            playSound('incorrect');
                            // Показ правильного ответа
                            optionsContainer.children[question.answer].classList.add('correct');
                            
                            // Показ пояснения
                            if (question.explanation) {
                                explanation.innerHTML = `<strong>Пояснение:</strong> ${question.explanation}`;
                                explanation.style.display = 'block';
                            }
                        }
                        
                        // Показать кнопку "Далее"
                        nextBtn.classList.remove('hidden');
                    });
                    
                    optionsContainer.appendChild(optionElement);
                });
                
                // Сброс переменных
                selectedOption = null;
                timeRemaining = timePerQuestion;
                timeLeft.textContent = timeRemaining;
                nextBtn.classList.add('hidden');
            }
            
            // Таймер
            function startTimer() {
                clearInterval(timer);
                timeRemaining = timePerQuestion;
                timeLeft.textContent = timeRemaining;
                
                timer = setInterval(() => {
                    timeRemaining--;
                    timeLeft.textContent = timeRemaining;
                    
                    if (timeRemaining <= 5 && timeRemaining > 0) {
                        playSound('timeup');
                    }
                    
                    if (timeRemaining <= 0) {
                        clearInterval(timer);
                        playSound('timeup');
                        
                        // Автоматический переход, если время вышло
                        if (selectedOption === null) {
                            answerTimes.push(timePerQuestion);
                            nextQuestion();
                        }
                    }
                }, 1000);
            }
            
            // Следующий вопрос
            function nextQuestion() {
                playSound('next');
                currentQuestionIndex++;
                
                if (currentQuestionIndex < questions.length) {
                    loadQuestion();
                    startTimer();
                } else {
                    showResults();
                }
            }
            
            nextBtn.addEventListener('click', nextQuestion);
            
            // Показать результаты
            function showResults() {
                testScreen.classList.remove('active');
                resultScreen.classList.add('active');
                menuPanel.classList.add('hidden');
                playSound('result');
                
                // Расчет IQ
                const calculatedIQ = calculateIQ(score, totalQuestionsCount);
                
                // Анимация подсчета IQ
                animateValue(iqScore, 0, calculatedIQ, 2000);
                correctAnswers.textContent = score;
                totalQuestionsResult.textContent = totalQuestionsCount;
                questionsCount.textContent = totalQuestionsCount;
                accuracy.textContent = Math.round((score/totalQuestionsCount)*100) + '%';
                
                // Установка уровня теста
                switch(totalQuestionsCount) {
                    case 15: testLevel.textContent = "Быстрый"; break;
                    case 30: testLevel.textContent = "Средний"; break;
                    case 50: testLevel.textContent = "Долгий"; break;
                }
                
                // Установка маркера на шкале IQ
                const markerPosition = Math.min(100, ((calculatedIQ - 70) / (130 - 70)) * 100);
                iqMarker.style.left = `${markerPosition}%`;
                
                // Установка текста результата
                setTimeout(() => {
                    resultText.textContent = getResultText(calculatedIQ);
                    resultDescription.textContent = getResultDescription(calculatedIQ);
                    
                    // Параметры расчета
                    iqParams.innerHTML = `
                        <div class="parameter">
                            <span class="param-name">minIQ (минимальный IQ):</span>
                            <span class="param-value">70</span>
                        </div>
                        <div class="parameter">
                            <span class="param-name">maxIQ (максимальный IQ):</span>
                            <span class="param-value">130</span>
                        </div>
                        <div class="parameter">
                            <span class="param-name">Правильные ответы:</span>
                            <span class="param-value">${score}</span>
                        </div>
                        <div class="parameter">
                            <span class="param-name">Всего вопросов:</span>
                            <span class="param-value">${totalQuestionsCount}</span>
                        </div>
                    `;
                    
                    // Запуск конфетти для высоких результатов
                    if (calculatedIQ >= 115) {
                        createConfetti();
                    }
                }, 2200);
            }
            
            // Расчет IQ
            function calculateIQ(correct, total) {
                const minIQ = 70;
                const maxIQ = 130;
                return Math.round(minIQ + (correct / total) * (maxIQ - minIQ));
            }
            
            // Анимация подсчета числа
            function animateValue(element, start, end, duration) {
                let startTimestamp = null;
                const step = (timestamp) => {
                    if (!startTimestamp) startTimestamp = timestamp;
                    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                    const value = Math.floor(progress * (end - start) + start);
                    element.textContent = value;
                    if (progress < 1) {
                        window.requestAnimationFrame(step);
                    }
                };
                window.requestAnimationFrame(step);
            }
            
            // Создание конфетти
            function createConfetti() {
                const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
                const container = document.querySelector('.container');
                
                for (let i = 0; i < 150; i++) {
                    const confetti = document.createElement('div');
                    confetti.classList.add('confetti');
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = `${Math.random() * 100}%`;
                    confetti.style.width = `${Math.random() * 10 + 5}px`;
                    confetti.style.height = confetti.style.width;
                    confetti.style.animationDuration = `${Math.random() * 3 + 2}s`;
                    container.appendChild(confetti);
                    
                    // Удаление конфетти после анимации
                    setTimeout(() => {
                        confetti.remove();
                    }, 5000);
                }
            }
            
            // Вспомогательные функции
            function getResultText(iq) {
                if (iq >= 130) return "Гениальный уровень!";
                if (iq >= 115) return "Высокий интеллект!";
                if (iq >= 85) return "Средний уровень";
                return "Ниже среднего";
            }
            
            function getResultDescription(iq) {
                if (iq >= 130) {
                    return "Ваш результат входит в 2% лучших результатов! Такой уровень интеллекта характерен для выдающихся ученых, изобретателей и руководителей высшего звена.";
                } else if (iq >= 115) {
                    return "Ваш интеллект выше среднего. Вы обладаете отличными аналитическими способностями и легко решаете сложные задачи.";
                } else if (iq >= 85) {
                    return "Ваш результат соответствует среднему уровню. Большинство людей имеют схожие показатели.";
                } else {
                    return "Ваш результат ниже среднего. Это может быть связано с усталостью или недостаточной концентрацией. Попробуйте пройти тест еще раз в спокойной обстановке.";
                }
            }
            
            // Перезапуск теста
            restartBtn.addEventListener('click', () => {
                playSound('start');
                resultScreen.classList.remove('active');
                levelScreen.classList.add('active');
            });
            
            // Возврат в меню
            menuPanel.addEventListener('click', () => {
                if (confirm('Вы уверены, что хотите прервать тест? Весь прогресс будет потерян.')) {
                    playSound('select');
                    testScreen.classList.remove('active');
                    levelScreen.classList.add('active');
                    menuPanel.classList.add('hidden');
                    clearInterval(timer);
                }
            });
            
            // Обработчики событий
            settingsPanel.addEventListener('click', () => {
                playSound('select');
                settingsModal.classList.add('active');
            });
            
            closeSettings.addEventListener('click', () => {
                playSound('select');
                settingsModal.classList.remove('active');
            });
            
            volumeSlider.addEventListener('input', (e) => {
                volume = e.target.value;
            });
            
            timeSlider.addEventListener('input', (e) => {
                timePerQuestion = parseInt(e.target.value);
                timeValue.textContent = `${timePerQuestion} секунд`;
            });
            
            themeOptions.forEach(option => {
                option.addEventListener('click', () => {
                    playSound('select');
                    themeOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    applyTheme(option.dataset.theme);
                });
            });
            
            levelCards.forEach(card => {
                card.addEventListener('click', () => {
                    playSound('select');
                    levelCards.forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    selectedLevel = card.dataset.level;
                });
            });
            
            saveSettingsBtn.addEventListener('click', saveSettings);
            
            // Обработчики вкладок результатов
            resultTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    playSound('select');
                    const tabName = tab.dataset.tab;
                    
                    resultTabs.forEach(t => t.classList.remove('active'));
                    resultContents.forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(`${tabName}Content`).classList.add('active');
                });
            });
            
            // Инициализация
            initAudio();
            loadSettings();
        });
    </script>
</body>
</html>
